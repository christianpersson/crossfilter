!function(n){function r(n){return n}function e(n,r){for(var e=0,t=r.length,u=Array(t);t>e;++e)u[e]=n[r[e]];return u}function t(n){function r(r,e,t,u){for(;u>t;){var o=t+u>>>1;n(r[o])<e?t=o+1:u=o}return t}function e(r,e,t,u){for(;u>t;){var o=t+u>>>1;e<n(r[o])?u=o:t=o+1}return t}return e.right=e,e.left=r,e}function u(n){function r(n,r,e){for(var u=e-r,o=(u>>>1)+1;--o>0;)t(n,o,u,r);return n}function e(n,r,e){for(var u,o=e-r;--o>0;)u=n[r],n[r]=n[r+o],n[r+o]=u,t(n,1,o,r);return n}function t(r,e,t,u){for(var o,f=r[--u+e],i=n(f);(o=e<<1)<=t&&(t>o&&n(r[u+o])>n(r[u+o+1])&&o++,!(i<=n(r[u+o])));)r[u+e]=r[u+o],e=o;r[u+e]=f}return r.sort=e,r}function o(n){function r(r,t,u,o){var f,i,a,c,l=Array(o=Math.min(u-t,o));for(i=0;o>i;++i)l[i]=r[t++];if(e(l,0,o),u>t){f=n(l[0]);do(a=n(c=r[t])>f)&&(l[0]=c,f=n(e(l,0,o)[0]));while(++t<u)}return l}var e=u(n);return r}function f(n){function r(r,e,t){for(var u=e+1;t>u;++u){for(var o=u,f=r[u],i=n(f);o>e&&n(r[o-1])>i;--o)r[o]=r[o-1];r[o]=f}return r}return r}function i(n){function r(n,r,u){return(S>u-r?t:e)(n,r,u)}function e(e,t,u){var o,f=0|(u-t)/6,i=t+f,a=u-1-f,c=t+u-1>>1,l=c-f,v=c+f,s=e[i],h=n(s),d=e[l],p=n(d),g=e[c],x=n(g),w=e[v],y=n(w),m=e[a],E=n(m);h>p&&(o=s,s=d,d=o,o=h,h=p,p=o),y>E&&(o=w,w=m,m=o,o=y,y=E,E=o),h>x&&(o=s,s=g,g=o,o=h,h=x,x=o),p>x&&(o=d,d=g,g=o,o=p,p=x,x=o),h>y&&(o=s,s=w,w=o,o=h,h=y,y=o),x>y&&(o=g,g=w,w=o,o=x,x=y,y=o),p>E&&(o=d,d=m,m=o,o=p,p=E,E=o),p>x&&(o=d,d=g,g=o,o=p,p=x,x=o),y>E&&(o=w,w=m,m=o,o=y,y=E,E=o);var I=d,b=p,A=w,k=y;e[i]=s,e[l]=e[t],e[c]=g,e[v]=e[u-1],e[a]=m;var O=t+1,R=u-2,M=k>=b&&b>=k;if(M)for(var U=O;R>=U;++U){var z=e[U],N=n(z);if(b>N)U!==O&&(e[U]=e[O],e[O]=z),++O;else if(N>b)for(;;){var _=n(e[R]);{if(!(_>b)){if(b>_){e[U]=e[O],e[O++]=e[R],e[R--]=z;break}e[U]=e[R],e[R--]=z;break}R--}}}else for(var U=O;R>=U;U++){var z=e[U],N=n(z);if(b>N)U!==O&&(e[U]=e[O],e[O]=z),++O;else if(N>k)for(;;){var _=n(e[R]);{if(!(_>k)){b>_?(e[U]=e[O],e[O++]=e[R],e[R--]=z):(e[U]=e[R],e[R--]=z);break}if(R--,U>R)break}}}if(e[t]=e[O-1],e[O-1]=I,e[u-1]=e[R+1],e[R+1]=A,r(e,t,O-1),r(e,R+2,u),M)return e;if(i>O&&R>a){for(var C,_;(C=n(e[O]))<=b&&C>=b;)++O;for(;(_=n(e[R]))<=k&&_>=k;)--R;for(var U=O;R>=U;U++){var z=e[U],N=n(z);if(b>=N&&N>=b)U!==O&&(e[U]=e[O],e[O]=z),O++;else if(k>=N&&N>=k)for(;;){var _=n(e[R]);{if(!(k>=_&&_>=k)){b>_?(e[U]=e[O],e[O++]=e[R],e[R--]=z):(e[U]=e[R],e[R--]=z);break}if(R--,U>R)break}}}}return r(e,O,R+1)}var t=f(n);return r}function a(n){for(var r=Array(n),e=-1;++e<n;)r[e]=0;return r}function c(n,r){for(var e=n.length;r>e;)n[e++]=0;return n}function l(n,r){if(r>32)throw Error("invalid array width!");return n}function v(n,r){return function(e){var t=e.length;return[n.left(e,r,0,t),n.right(e,r,0,t)]}}function s(n,r){var e=r[0],t=r[1];return function(r){var u=r.length;return[n.left(r,e,0,u),n.left(r,t,0,u)]}}function h(n){return[0,n.length]}function d(){return null}function p(){return 0}function g(n){return n+1}function x(n){return n-1}function w(n){return function(r,e){return r+ +n(e)}}function y(n){return function(r,e){return r-n(e)}}function m(n,r){for(var e,t,u=[],o=[],f=newIndex=0;f<n.length&&newIndex<r.length;)e=r[newIndex],t=n[f],e===t?(f++,newIndex++):e>t?(o.push(t),f++):(u.push(e),newIndex++);for(;f<n.length;)o.push(n[f]),f++;for(;newIndex<r.length;)u.push(r[newIndex]),newIndex++;return[u,o]}function E(n){var r=[];return n.forEach(function(n){r.push([n[0],1]),r.push([n[1],0])}),r}function I(n){console.log(n);for(var r,e,t,u=[],o=[],f=1;f<n.length;f++)r=n[f-1][1],e=n[f-1][0],t=n[f][0],1===r?u.push([e,t]):-1===r&&o.push([e,t]);return[u,o]}function b(n,r){for(var e,t,u=newIndex=0,o=[],f=0,i=0;u<r.length&&newIndex<n.length;)t=n[newIndex],e=r[u],t[0]>e[0]?(f=e[1],u++):t[0]<e[0]?(i=t[1],newIndex++):(i=t[1],f=e[1],u++,newIndex++),console.log(u,newIndex),o.push([Math.min(e[0],t[0]),i-f]);for(;u<r.length;)o.push([r[u][0],-r[u][1]]),u++;for(;newIndex<n.length;)o.push([n[newIndex][0],n[newIndex][1]]),newIndex++;return o}function A(n,r){var e=E(n),t=E(r),u=b(t,e);return I(u)}function k(){function n(n){var r=I,e=n.length;return e&&(E=E.concat(n),z=V(z,I+=e),_.forEach(function(t){t(n,r,e)})),l}function t(){for(var n=O(I,I),r=[],e=0,t=0;I>e;++e)z[e]?n[e]=t++:r.push(e);N.forEach(function(n){n(0,[],r)}),C.forEach(function(r){r(n)});for(var u,e=0,t=0;I>e;++e)(u=z[e])&&(e!==t&&(z[t]=u,E[t]=E[e]),++t);for(E.length=t;I>t;)z[--I]=0}function f(n){function t(r,t,u){T=r.map(n),W=nr(R(u),0,u),T=e(T,W);var o,f=rr(T),i=f[0],a=f[1];if(X)for(o=0;u>o;++o)X(T[o],o)||(z[W[o]+t]|=Z);else{for(o=0;i>o;++o)z[W[o]+t]|=Z;for(o=a;u>o;++o)z[W[o]+t]|=Z}if(!t)return P=T,Q=W,ur=i,or=a,void 0;var c=P,l=Q,v=0,s=0;for(P=Array(I),Q=O(I,I),o=0;t>v&&u>s;++o)c[v]<T[s]?(P[o]=c[v],Q[o]=l[v++]):(P[o]=T[s],Q[o]=W[s++]+t);for(;t>v;++v,++o)P[o]=c[v],Q[o]=l[v];for(;u>s;++s,++o)P[o]=T[s],Q[o]=W[s]+t;f=rr(P),ur=f[0],or=f[1]}function f(n,r,e){er.forEach(function(n){n(T,W,r,e)}),T=W=null}function a(n){for(var r,e=0,t=0;I>e;++e)z[r=Q[e]]&&(e!==t&&(P[t]=P[e]),Q[t]=n[r],++t);for(P.length=t;I>t;)Q[t++]=0;var u=rr(P);ur=u[0],or=u[1]}function c(n){var r=n[0],e=n[1];if(X)return X=null,B(function(n,t){return t>=r&&e>t}),ur=r,or=e,Y;var t,u,o,f=[],i=[];if(ur>r)for(t=r,u=Math.min(ur,e);u>t;++t)z[o=Q[t]]^=Z,f.push(o);else if(r>ur)for(t=ur,u=Math.min(r,or);u>t;++t)z[o=Q[t]]^=Z,i.push(o);if(e>or)for(t=Math.max(r,or),u=e;u>t;++t)z[o=Q[t]]^=Z,f.push(o);else if(or>e)for(t=Math.max(ur,e),u=or;u>t;++t)z[o=Q[t]]^=Z,i.push(o);return ur=r,or=e,N.forEach(function(n){n(Z,f,i)}),Y}function l(n){return null==n?q():Array.isArray(n)?S(n):"function"==typeof n?D(n):A(n)}function A(n){return c((rr=v(U,n))(P))}function S(n){return c((rr=s(U,n))(P))}function q(){return c((rr=h)(P))}function D(n){return rr=h,B(X=n),ur=0,or=I,Y}function F(n){console.log(n);var r,e,t=[],u=[];if(0===fr.length&&1===n.length){var o=U.left(P,n[0],0,I),f=U.right(P,n[0],o,I);for(r=0;o>r;r++)z[e=Q[r]]^=Z,u.push(e),console.log("Removed",r,P[r]);for(r=f;I>r;r++)z[e=Q[r]]^=Z,u.push(e),console.log("Removed",r,P[r])}else{var i=m(fr,n);console.log(i);var a=0,c=i[0].map(function(n){var r=[U.left(P,n,a,I),U.right(P,n,a,I)];return a=r[1],r});a=0;var l=i[1].map(function(n){var r=[U.left(P,n,a,I),U.right(P,n,a,I)];return a=r[1],r});c.forEach(function(n){for(r=n[0];r<n[1];++r)z[e=Q[r]]^=Z,t.push(e),console.log("Added",r,P[r])}),l.forEach(function(n){for(r=n[0];r<n[1];++r)z[e=Q[r]]^=Z,u.push(e),console.log("Removed...",r,P[r])})}return N.forEach(function(n){n(Z,t,u)}),fr=n,ur=0,or=I,Y}function B(n){var r,e,t,u=[],o=[];for(r=0;I>r;++r)!(z[e=Q[r]]&Z)^!!(t=n(P[r],r))&&(t?(z[e]&=$,u.push(e)):(z[e]|=Z,o.push(e)));N.forEach(function(n){n(Z,u,o)})}function G(n){for(var r,e=[],t=or;--t>=ur&&n>0;)z[r=Q[t]]||(e.push(E[r]),--n);return e}function H(n){for(var r,e=[],t=ur;or>t&&n>0;)z[r=Q[t]]||(e.push(E[r]),--n),t++;return e}function J(n){function e(r,e,t,u){function o(){++Y===X&&(w=j(w,W<<=1),G=j(G,W),X=M(W))}var l,v,s,h,p,g,x=B,w=O(Y,X),y=K,m=T,b=Y,A=0,k=0;for(ur&&(y=m=d),B=Array(Y),Y=0,G=b>1?V(G,I):O(I,X),b&&(s=(v=x[0]).key);u>k&&!((h=n(r[k]))>=h);)++k;for(;u>k;){for(v&&h>=s?(p=v,g=s,w[A]=Y,(v=x[++A])&&(s=v.key)):(p={key:h,value:m()},g=h),B[Y]=p;!(h>g||(G[l=e[k]+t]=Y,z[l]&$||(p.value=y(p.value,E[l])),++k>=u));)h=n(r[k]);o()}for(;b>A;)B[w[A]=Y]=x[A++],o();if(Y>A)for(A=0;t>A;++A)G[A]=w[G[A]];l=N.indexOf(nr),Y>1?(nr=f,rr=a):(!Y&&or&&(Y=1,B=[{key:null,value:m()}]),1===Y?(nr=i,rr=c):(nr=d,rr=d),G=null),N[l]=nr}function t(){if(Y>1){for(var n=Y,r=B,e=O(n,n),t=0,u=0;I>t;++t)z[t]&&(e[G[u]=G[t]]=1,++u);for(B=[],Y=0,t=0;n>t;++t)e[t]&&(e[t]=Y++,B.push(r[t]));if(Y>1)for(var t=0;u>t;++t)G[t]=e[G[t]];else G=null;N[N.indexOf(nr)]=Y>1?(rr=a,nr=f):1===Y?(rr=c,nr=i):rr=nr=d}else if(1===Y){if(or)return;for(var t=0;I>t;++t)if(z[t])return;B=[],Y=0,N[N.indexOf(nr)]=nr=rr=d}}function f(n,r,e){if(n!==Z&&!ur){var t,u,o,f;for(t=0,o=r.length;o>t;++t)z[u=r[t]]&$||(f=B[G[u]],f.value=K(f.value,E[u]));for(t=0,o=e.length;o>t;++t)(z[u=e[t]]&$)===n&&(f=B[G[u]],f.value=L(f.value,E[u]))}}function i(n,r,e){if(n!==Z&&!ur){var t,u,o,f=B[0];for(t=0,o=r.length;o>t;++t)z[u=r[t]]&$||(f.value=K(f.value,E[u]));for(t=0,o=e.length;o>t;++t)(z[u=e[t]]&$)===n&&(f.value=L(f.value,E[u]))}}function a(){var n,r;for(n=0;Y>n;++n)B[n].value=T();for(n=0;I>n;++n)z[n]&$||(r=B[G[n]],r.value=K(r.value,E[n]))}function c(){var n,r=B[0];for(r.value=T(),n=0;I>n;++n)z[n]&$||(r.value=K(r.value,E[n]))}function l(){return ur&&(rr(),ur=!1),B}function v(n){var r=H(l(),0,B.length,n);return J.sort(r,0,r.length)}function s(n,r,e){return K=n,L=r,T=e,ur=!0,F}function h(){return s(g,x,p)}function m(n){return s(w(n),y(n),p)}function b(n){return function(r,e){return n.forEach(function(n){r[n]+=e[n]}),r._count++,r}}function A(n){return function(r,e){return n.forEach(function(n){r[n]-=e[n]}),r._count--,r}}function k(n){return function(){var r={};return n.forEach(function(n){r[n]=0}),r._count=0,r}}function R(n){return n instanceof Array?s(b(n),A(n),k(n)):m(function(r){return r[n]})}function U(n,r,e){function t(r,e){return r[e[n]]||(r[e[n]]=a()),r[e[n]]=f(r[e[n]],e),r}function u(r,e){return r[e[n]]=i(r[e[n]],e),r}function o(){return{}}console.log(n,r,e);var f,i,a;if(void 0===n)throw"ERROR";if(1===arguments.length)f=g,i=x,a=p;else if(1===r.length&&void 0===e){var c=function(n){return n[r[0]]};f=w(c),i=y(c),a=p}else{var c=r[0];f=b(r),i=A(r),a=k(r)}return s(t,u,o)}function _(n){function r(r){return n(r.value)}return H=o(r),J=u(r),F}function S(){return _(r)}function q(){return Y}function D(){var n=N.indexOf(nr);return n>=0&&N.splice(n,1),n=er.indexOf(e),n>=0&&er.splice(n,1),n=C.indexOf(t),n>=0&&C.splice(n,1),F}var F={top:v,all:l,reduce:s,reduceCount:h,reduceSum:m,reduce2D:U,reduceMetrics:R,order:_,orderNatural:S,size:q,dispose:D,remove:D};tr.push(F);var B,G,H,J,K,L,T,W=8,X=M(W),Y=0,nr=d,rr=d,ur=!0,or=n===d;return arguments.length<1&&(n=r),N.push(nr),er.push(e),C.push(t),e(P,Q,0,I),h().orderNatural()}function K(){var n=J(d),r=n.all;return delete n.all,delete n.top,delete n.order,delete n.orderNatural,delete n.size,n.value=function(){return r()[0].value},n}function L(){tr.forEach(function(n){n.dispose()});var n=_.indexOf(t);return n>=0&&_.splice(n,1),n=_.indexOf(f),n>=0&&_.splice(n,1),n=C.indexOf(a),n>=0&&C.splice(n,1),b&=$,q()}var P,Q,T,W,X,Y={filter:l,filterExact:A,filterRange:S,filterFunction:D,filterAll:q,filterValues:F,top:G,bottom:H,group:J,groupAll:K,dispose:L,remove:L},Z=~b&-~b,$=~Z,nr=i(function(n){return T[n]}),rr=h,er=[],tr=[],ur=0,or=0,fr=[];return _.unshift(t),_.push(f),C.push(a),b|=Z,(k>=32?!Z:b&(1<<k)-1)&&(z=j(z,k<<=1)),t(E,0,I),f(E,0,I),Y}function a(){function n(n,r){var e;if(!h)for(e=r;I>e;++e)z[e]||(a=c(a,E[e]))}function r(n,r,e){var t,u,o;if(!h){for(t=0,o=r.length;o>t;++t)z[u=r[t]]||(a=c(a,E[u]));for(t=0,o=e.length;o>t;++t)z[u=e[t]]===n&&(a=l(a,E[u]))}}function e(){var n;for(a=v(),n=0;I>n;++n)z[n]||(a=c(a,E[n]))}function t(n,r,e){return c=n,l=r,v=e,h=!0,s}function u(){return t(g,x,p)}function o(n){return t(w(n),y(n),p)}function f(){return h&&(e(),h=!1),a}function i(){var e=N.indexOf(r);return e>=0&&N.splice(e),e=_.indexOf(n),e>=0&&_.splice(e),s}var a,c,l,v,s={reduce:t,reduceCount:u,reduceSum:o,value:f,dispose:i,remove:i},h=!0;return N.push(r),_.push(n),n(E,0,I),u()}function c(){return I}var l={add:n,remove:t,dimension:f,groupAll:a,size:c,subtractRanges:A},E=[],I=0,b=0,k=8,z=q(0),N=[],_=[],C=[];return arguments.length?n(arguments[0]):l}function O(n,r){return(257>r?q:65537>r?D:F)(n)}function R(n){for(var r=O(n,n),e=-1;++e<n;)r[e]=e;return r}function M(n){return 8===n?256:16===n?65536:4294967296}k.version="1.3.11",k.permute=e;var U=k.bisect=t(r);U.by=t;var z=k.heap=u(r);z.by=u;var N=k.heapselect=o(r);N.by=o;var _=k.insertionsort=f(r);_.by=f;var C=k.quicksort=i(r);C.by=i;var S=32,q=a,D=a,F=a,V=c,j=l;"undefined"!=typeof Uint8Array&&(q=function(n){return new Uint8Array(n)},D=function(n){return new Uint16Array(n)},F=function(n){return new Uint32Array(n)},V=function(n,r){if(n.length>=r)return n;var e=new n.constructor(r);return e.set(n),e},j=function(n,r){var e;switch(r){case 16:e=D(n.length);break;case 32:e=F(n.length);break;default:throw Error("invalid array width!")}return e.set(n),e}),n.crossfilter=k}("undefined"!=typeof exports&&exports||this);